<!-- src/views/admin/reportes/estadisticas.ejs -->
<h1>Estadísticas Mensuales de Reservas</h1>
<p class="descripcion">Vista materializada con estadísticas agregadas por mes (actualizada automáticamente).</p>

<a href="/admin/reportes" class="btn btn-secondary">Volver</a>

<% if (typeof data !== 'undefined' && data.length > 0) { %>
  <div class="estadisticas-grid">
    <% data.slice(0, 3).forEach(stat => { %>
      <div class="stat-card">
        <h3><%= new Date(stat.mes).toLocaleDateString('es', { year: 'numeric', month: 'long' }) %></h3>
        <div class="stat-details">
          <div class="stat-item">
            <span class="label">Total Reservas:</span>
            <span class="value"><%= stat.total_reservas %></span>
          </div>
          <div class="stat-item success">
            <span class="label">Confirmadas:</span>
            <span class="value"><%= stat.confirmadas %></span>
          </div>
          <div class="stat-item danger">
            <span class="label">Canceladas:</span>
            <span class="value"><%= stat.canceladas %></span>
          </div>
          <div class="stat-item warning">
            <span class="label">No Utilizadas:</span>
            <span class="value"><%= stat.no_utilizadas %></span>
          </div>
          <div class="stat-item primary">
            <span class="label">Ingresos Totales:</span>
            <span class="value">$<%= parseFloat(stat.ingresos_totales).toFixed(2) %></span>
          </div>
          <div class="stat-item">
            <span class="label">Valor Promedio:</span>
            <span class="value">$<%= parseFloat(stat.valor_promedio).toFixed(2) %></span>
          </div>
          <div class="stat-item">
            <span class="label">Hoteles Activos:</span>
            <span class="value"><%= stat.hoteles_activos %></span>
          </div>
          <div class="stat-item">
            <span class="label">Huéspedes Únicos:</span>
            <span class="value"><%= stat.huespedes_unicos %></span>
          </div>
        </div>
      </div>
    <% }) %>
  </div>

  <h3>Histórico Completo</h3>
  <table>
    <thead>
      <tr>
        <th>Mes</th>
        <th>Total</th>
        <th>Confirmadas</th>
        <th>Canceladas</th>
        <th>No Utilizadas</th>
        <th>Ingresos</th>
        <th>Promedio</th>
        <th>Hoteles</th>
        <th>Huéspedes</th>
      </tr>
    </thead>
    <tbody>
      <% data.forEach(stat => { %>
        <tr>
          <td><%= new Date(stat.mes).toLocaleDateString('es', { year: 'numeric', month: 'short' }) %></td>
          <td><%= stat.total_reservas %></td>
          <td class="text-success"><%= stat.confirmadas %></td>
          <td class="text-danger"><%= stat.canceladas %></td>
          <td class="text-warning"><%= stat.no_utilizadas %></td>
          <td>$<%= parseFloat(stat.ingresos_totales).toFixed(2) %></td>
          <td>$<%= parseFloat(stat.valor_promedio).toFixed(2) %></td>
          <td><%= stat.hoteles_activos %></td>
          <td><%= stat.huespedes_unicos %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } else { %>
  <p class="no-resultados">No hay estadísticas disponibles.</p>
<% } %>

<style>
.estadisticas-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 20px;
  margin: 20px 0;
}
.stat-card {
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.stat-card h3 {
  margin: 0 0 15px 0;
  color: #007bff;
  border-bottom: 2px solid #007bff;
  padding-bottom: 10px;
}
.stat-details {
  display: grid;
  gap: 10px;
}
.stat-item {
  display: flex;
  justify-content: space-between;
  padding: 8px;
  background: #f8f9fa;
  border-radius: 4px;
}
.stat-item.success { background: #d4edda; }
.stat-item.danger { background: #f8d7da; }
.stat-item.warning { background: #fff3cd; }
.stat-item.primary { background: #cce5ff; font-weight: bold; }
.stat-item .label { color: #495057; }
.stat-item .value { font-weight: bold; color: #212529; }
.text-success { color: #28a745; }
.text-danger { color: #dc3545; }
.text-warning { color: #ffc107; }
</style>
